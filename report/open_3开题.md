## 实施方案

​		本设计以STM32单片机作为控制核心，通过蓝牙协议与上位机APP建立通信，实现音频配置与灯效控制。人机交互方面系统采用 SPI 接口驱动电容式 LCD 触摸屏用于界面显示与用户输入；使用时序控制方式控制 WS2812 灯珠组，用于呈现亮度可调、颜色可调的夜灯效果；音频输出部分由 STM32 通过 I2S 向数字功放模块持续发送音频数据，功放再驱动喇叭实现声音播放。

![image-20251206163140245](C:\Users\权恒毅\AppData\Roaming\Typora\typora-user-images\image-20251206163140245.png)

**具体实现方案**

​	（1）控制核心： STM32F103 单片机属于基于 ARM Cortex-M3 内核的 32 位微控制器，主频最高可达 72 MHz，具备较高的运算能力和良好的外设资源，非常适合承担智能疗愈系统中的多任务控制需求。它内部集成丰富的定时器、SPI、I2C、USART 以及 DMA 控制器，可用于驱动 LCD 触摸屏、管理 WS2812 灯效时序、处理蓝牙通信并提高数据传输效率；同时提供 I2S 兼容接口，可与数字功放模块协同实现音频数据输出。F103 功耗低、成本适中、生态成熟，外围库和示例丰富，能够满足本项目在显示、灯光、通信和音频控制等方面的综合需求。

​	（2）WS2812B可编程灯珠： WS2812B 灯珠是一种集成了 RGB 发光芯片和控制电路的智能全彩 LED，每颗灯珠内部都带有独立的驱动 IC，能够通过单线时序实现逐点独立控制。单片机仅需使用一根数据线即可进行颜色与亮度的设置，数据在灯珠间自带级联传输，适合组成灯带或灯阵结构。WS2812B 支持 24bit 颜色编码，可呈现 1670 万种颜色，响应速度快，非常适合作为智能疗愈系统的动态灯效模块。在本项目中，STM32 通过精确的时序控制输出数据流，驱动灯珠随音乐或界面状态产生变色、呼吸、流动等效果。

​	（3）LCD电容触摸屏： LCD 触摸屏作为主要的人机交互界面，能够显示系统状态、音量调节、灯效模式以及蓝牙连接信息等内容。该屏幕通常使用 SPI 接口与 STM32F103 相连，具有通信线少、刷新速度快、驱动简洁的特点，适合嵌入式小型终端使用。在本项目中，LCD 触摸屏不仅用于展示界面 UI，还承担播放控制、灯效切换等输入功能。

​	（4）数字功放模块： 音频功放模块通过 I2S 接口与 STM32F103 协同工作，负责将单片机输出的数字音频数据转换并放大后驱动喇叭发声。系统中音频文件预先存储在外部 Flash 或 SD 卡中，STM32 通过读取、解码和缓存的方式对音频数据进行简单处理，再以固定采样率通过 I2S 持续发送给功放模块。功放接收数字音频流后完成内部转换与功率放大，使最终的声音能够稳定输出。



## 任务内容与指标

**任务内容**

（1）设计STM32最小系统以及驱zhi动LCD触摸屏幕、WS2812灯珠、数字功放模块的外围电路。

（2）内置白噪音音频文件，并能够实现音频播放，支持TF卡扩展存储。

（3）能够设置多模式定时关闭（5/10/15/30/60分钟可选）。

（4）夜灯模式亮度、颜色可调节。

（5）设计上位机APP，支持音量调节、模式切换、定时设置。

（6）设计场景化预设模式，能够通过LCD屏幕一键切换对应的白噪音与亮度组合。

（7）完成整个系统的控制系统框图和软件流程图。

（8）制作出样机并调试。

**指标**

（1）夜灯亮度0-100%可调，功耗＜3w。

（2）支持蓝牙连接，传输距离≥10m。

（3）待机功耗＜0.5w，运行噪音＜30dB。

（4）内置≥15种音频文件，场景化预设模式≥3种。